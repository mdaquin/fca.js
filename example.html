<!DOCTYPE html>
<html>
  <head>
    <title>FCA example</title>
    <script src="bvo.js"></script>
    <script src="fca.js"></script>
    <meta charset="utf-8" />
    <style>
    *{font-family: Courier;}
    </style>
  </head>
  <body>
    <p>Example of FCA application</p>
    <p>This uses a dataset of countries and there caracteristics.</p>
    
    <div id="message"></div>

    <div id="control">
<!--    <div id="high_level_control">
    Load: <input type="file" id="file-input"/>
    <a class="button" href="javascript:save();">Save</a>
    </div>
    -->
    <h2>Process</h2>
    <div id="buildconcept" style="margin-top: 10px;">
    <a class="button" href="javascript:buildconcepts()">Build concepts</a>
    <span id="bc_message">On my laptop, it takes a few minutes.</span>
    </div>
    <div id="buildtaxonomy" style="margin-top: 10px;">
    <a class="button" href="javascript:buildtaxonomy()">Build Taxonomy</a>
    <span id="bt_message">On my laptop, it takes a few minutes again.</span>
    </div>
    <div id="populate" style="margin-top: 10px;">
    <a class="button" href="javascript:populate()">Populate and add labels</a>
    <span id="p_message">This takes less time... but still a bit</span>
    </div>
    <div id="rules" style="margin-top: 10px;">
    <a class="button" href="javascript:rules()">Extract rules</a>
    <span id="r_message">This takes less time... but still a bit</span>
    </div>    
    </div> <!-- control -->


    <h2>Lattice</h2>
    <div id="lattice">Something will appear here when the process is complete.</div>

    <h2>Rules</h2>
    <div id="rules_ex">Something will appear here when the rules are extracted.</div>

    <!-- data from example data folder: fc_attributes and fc_objects --> 
    <script>

var stage = 0

const attributes = ["area:unknown", "area:low", "area:medium", "area:high", "population:unknown", "population:low", "population:medium", "population:high", "mains voltage:unknown", "mains voltage:low", "mains voltage:medium", "mains voltage:high", "driving side:unknown", "driving side:right", "driving side:left", "inflation rate:unknown", "inflation rate:low", "inflation rate:medium", "inflation rate:high", "total fertility rate:unknown", "total fertility rate:low", "total fertility rate:medium", "total fertility rate:high", "PPP GDP per capita:unknown", "PPP GDP per capita:low", "PPP GDP per capita:medium", "PPP GDP per capita:high", "life expectancy:unknown", "life expectancy:low", "life expectancy:medium", "life expectancy:high", "has quality:unknown", "has quality:free country", "has quality:historical country", "has quality:partly free country", "has quality:not-free country", "nominal GDP per capita:unknown", "nominal GDP per capita:low", "nominal GDP per capita:medium", "nominal GDP per capita:high", "nominal GDP:unknown", "nominal GDP:low", "nominal GDP:medium", "nominal GDP:high"]

const fc_objects = {"Canada": [false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, false, false, true], "East Timor": [false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, true, false, false, false, true, false, false, true, false, false], "Turkmenistan": [false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, true, false], "United States of America": [false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, false, false, true], "Cambodia": [false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, false, false, false, true, false, true, false, false, false, false, true, false], "Republic of the Congo": [false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, false, true, false, true, false, false, false, true, false, false], "Ethiopia": [false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, false, true, false, true, false, false, false, false, false, true], "The Gambia": [false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, false, true, false, true, false, false, false, true, false, false], "Sri Lanka": [false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, false, true], "Bolivia": [false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, false, true, false], "Cameroon": [false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, false, true, false, true, false, false, false, false, true, false], "Burkina Faso": [false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, false, false, true], "Ghana": [false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, false, true, false], "Saudi Arabia": [false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false], "Cape Verde": [false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, false, true, false, false, true, false, false], "Guatemala": [false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, true, false], "Guinea": [false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, false, false, true, false], "Germany": [false, false, true, false, false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, false, false, true], "Dominica": [false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, true, false, false, false, false, true, false, true, false, false, false, false, false, true, false, false, true, false, false], "Liberia": [false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, false, true, false, false], "Netherlands": [false, true, false, false, false, false, false, true, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, false, false, true], "Pakistan": [false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, true, false], "Oman": [false, false, true, false, false, true, false, false, false, false, false, true, false, true, false, false, true, false, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, false, true, false, true, false, false, false, true, false, false], "Tanzania": [false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, false, false, true], "Ivory Coast": [false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, true, false, false, false, false, true, false, false, true, false], "People's Republic of China": [false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, false, true, false, true, false, false, false, false, false, true], "New Zealand": [false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, false, false, true], "Yemen": [false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, false, true, false, false, true, false, false, false, false, true], "Jamaica": [false, true, false, false, false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, true, false, false, false, false, false, true, false, false, false, true, false], "Samoa": [false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, false, false, true, false, false, true, false, false], "United Arab Emirates": [false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, true], "India": [false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, false, false, true], "Lesotho": [false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, true, false, false], "Saint Vincent and the Grenadines": [false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, false], "Kenya": [false, false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, false, true, false], "South Korea": [false, false, true, false, false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, true, false, false, false, false, true, false], "Tajikistan": [false, false, true, false, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, true, false], "Turkey": [false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, false, true], "Afghanistan": [false, false, false, true, false, false, false, true, false, false, false, true, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, false, true, false, true, false, false, false, true, false, false], "Czech Republic": [false, false, true, false, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, false, false, true], "Mauritania": [false, false, false, true, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, false, true, false, true, false, false, false, false, false, true], "Solomon Islands": [false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, true, false, true, false, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, false], "Saint Lucia": [false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, false, false, true, false, true, false, false], "Mongolia": [false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, false, false, true, false, false, true, false], "France": [false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, false, false, true], "Rwanda": [false, true, false, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, false, true, false, true, false, false, false, true, false, false], "Slovakia": [false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, false, false, true], "Peru": [false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, false, true, false, false, false, true, false], "Vanuatu": [false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, false, true, false, true, false, false, false, false, true, false, false, true, false, false, false, false, false, false, true, false, true, false, false], "Norway": [false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, false, false, true], "Malawi": [false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, true, false, false], "Benin": [false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, true, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false], "Federated States of Micronesia": [false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, true, false, false, false, false, true, false, false, true, false, false, false, false, false, false, true, false, true, false, false], "Singapore": [false, true, false, false, false, false, true, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false], "Montenegro": [false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, true, false], "Saint Kitts and Nevis": [false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, true, false, false, true, false, false], "Togo": [false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, false, false, true], "Dominican Republic": [false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, true, false], "Bahrain": [false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, true, false], "Finland": [false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, false, false, true], "Libya": [false, false, false, true, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, false, true, false, false, false, true, false, false, false, true], "Indonesia": [false, false, false, true, false, false, false, true, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, false, true], "Central African Republic": [false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, false, true, false, false, true, false, false, true, false, false], "Mauritius": [false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, false, true, false, false, false, true, false], "Vietnam": [false, false, true, false, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, true], "Mali": [false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, true, false, false], "Bulgaria": [false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, false, false, true, false, false, false, true], "Romania": [false, false, true, false, false, false, false, true, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, false, true, false, false, false, true], "Chad": [false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, false, true, false, true, false, false, false, true, false, false], "South Africa": [false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, false, true, false, false, false, true], "Fiji": [false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, true, false, false], "Malaysia": [false, false, true, false, false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false], "Austria": [false, false, true, false, false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, false, false, true], "Mozambique": [false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, false, false, true, false], "Uganda": [false, false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, false, true, false, true, false, false, false, true, false, false], "Japan": [false, false, true, false, false, false, false, true, false, true, false, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, true, false, false, false, false, true], "Niger": [false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, true, false, false], "Brazil": [false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, true, false, true, false, false, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, false, false, false, true], "The Bahamas": [false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, true, false, false], "Costa Rica": [false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, false, true, false, true, false, false, false, false, false, true, false, false, true, false, false], "Ireland": [false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, true, false, false, false, true, false], "Palau": [false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, false, true, false, true, false, false], "Nigeria": [false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, false, true, false], "Ecuador": [false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false], "Bangladesh": [false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, true, false], "Brunei": [false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false], "Australia": [false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, false, false, true], "Iran": [false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, true, false, false, false, false, false, true, false, false, true, false, false, false, false, false, true, false, true, false, false, false, false, false, true], "Algeria": [false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, true, false], "El Salvador": [false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, false, true, false, false, false, true, false], "Chile": [false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, false, true, false, true, false, false, false, false, false, true, false, false, false, true, false], "Kiribati": [false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, false, true, false, false, true, false, false], "Haiti": [false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, false, true, false], "Iraq": [false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, true, false], "Sierra Leone": [false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, true, false, false], "Nepal": [false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, true, false, false], "Denmark": [false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, false, false, true], "Poland": [false, false, true, false, false, false, false, true, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, false, false, true], "Morocco": [false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, true, false], "Croatia": [false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, false, false, true], "Guinea-Bissau": [false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, true, false, false], "Thailand": [false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, false, false, true, false, true, false, false, false, false, true, false], "Grenada": [false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, false, false, true, false, false, true, false], "Seychelles": [false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false], "Portugal": [false, false, true, false, false, false, false, true, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, true, false, false, false, true, false], "Uruguay": [false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, true, false, false, false, true, false], "Lebanon": [false, true, false, false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, true, false], "Uzbekistan": [false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, false, true], "Tunisia": [false, false, true, false, false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, false, true, false, true, false, false, false, false, true, false, false, false, false, true, false], "Djibouti": [false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, false, true, false, false, false, true, false, true, false, false], "Antigua and Barbuda": [false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, true, false, false], "Colombia": [false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, false, true], "Burundi": [false, true, false, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, false, true, false, true, false, false, false, true, false, false], "Eswatini": [false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, false, true, false, true, false, false, false, true, false, false], "Nicaragua": [false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, true, false], "Barbados": [false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, true, false, false], "Madagascar": [false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, false, true, false], "Italy": [false, false, true, false, false, false, false, true, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, false, false, true], "Bhutan": [false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, false, true, false, false], "Sudan": [false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, false, true, false, true, false, false, false, false, true, false], "Laos": [false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, false, true, false, false, true, false, false, false, true, false], "Democratic Republic of the Congo": [false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, false, true, false, false, true, false, false, false, true, false], "Maldives": [false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, true, false, false], "S\u00e3o Tom\u00e9 and Pr\u00edncipe": [false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, true, false, false, true, false, false, false, false, false, true, false, false, true, false, false], "Venezuela": [false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, true], "Israel": [false, true, false, false, false, false, false, true, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, false, true, false], "Zambia": [false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, false, false, true, false], "Senegal": [false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, false, true, false, true, false, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false], "Papua New Guinea": [false, false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, true, false, false], "Zimbabwe": [false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, false, false, true, false], "Jordan": [false, false, true, false, false, false, false, true, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false], "Kazakhstan": [false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, true, false, false, false, false, false, true, false, false, true, false, false, false, false, false, true, false, false, false, true, false, false, false, true], "Philippines": [false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, false, true], "Eritrea": [false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, false, true, false, true, false, false, false, true, false, false], "Kyrgyzstan": [false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, true, false], "Trinidad and Tobago": [false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, true, false, false, true, false, false], "Latvia": [false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, false, false, true, false, false, true, false, false, false, false, false, false, true, false, false, false, true], "Guyana": [false, false, true, false, false, true, false, false, false, false, false, true, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, false, true, false, false, true, false, false], "Honduras": [false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, false, true, false, true, false, false], "Myanmar": [false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, false, false, true], "Mexico": [false, false, false, true, false, false, false, true, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true], "Egypt": [false, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, false, true, false, false, true, false, false, false, false, true], "Comoros": [false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, true, false, true, false, false, false, true, false, false, false, false, false, true, false, false, false, true, false, false, true, false, false], "United Kingdom": [false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, true, false, false, false, false, false, true, false, false, false, true, false, true, false, false, false, false, false, false, true, false, false, false, true], "Paraguay": [false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, false, true, false, false, true, false, false, false, true, false, false], "Namibia": [false, false, false, true, false, true, false, false, false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, false, false, false, true, false, false, true, false], "Botswana": [false, false, false, true, false, true, false, false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, true, false, false, true, false, false, false, true, false, false, false, false, true, false, false, false, true, false, false]}

const objects = Object.keys(fc_objects)
var matrix = []
var count = 0
for(var o in objects) {
    matrix.push(fc_objects[objects[o]])
    count++
//    if (count > 20) break
}
console.log(count)
</script>
    
<!-- building lattice -->
    <script>

(function (){
//document.getElementById("file-input")
//	.addEventListener("change", load, false);
})()

var formal_context = new FormalContext(attributes, objects, matrix)

function save(){
    data={stage: stage, concepts: []}
    for (var i in formal_context.concepts){
	var c = formal_context.concepts[i]
	var bv = new BinaryVector([])
	bv._representation = c.intent._representation
	bv.size = c.intent.size
	var nc = new Concept(bv, true)
	nc.subconcepts = []
	nc.superconcepts = []	
	for(var j in c.subconcepts){
	    var sc = c.subconcepts[j]
	    var sbv = new BinaryVector([])
	    sbv._representation = sc.intent._representation
	    sbv.size = sc.intent.size
	    var nsc = new Concept(sbv, true)
	    nc.subconcepts.push(nsc)
	}
	for(var j in c.superconcepts){
	    var sc = c.superconcepts[j]
	    var sbv = new BinaryVector([])
	    sbv._representation = sc.intent._representation
	    sbv.size = sc.intent.size
	    var nsc = new Concept(sbv, true)
	    nc.superconcepts.push(nsc)
	}
	data.concepts.push(nc)
    }
    var file = new Blob([JSON.stringify(data)], {type: "application/json"});
    var filename = "fca.json"
    if (window.navigator.msSaveOrOpenBlob) {
        window.navigator.msSaveOrOpenBlob(file, filename);
    } else { 
        var a = document.createElement("a"),
            url = URL.createObjectURL(file);
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        setTimeout(function() {
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);  
        }, 0); 
    }
}

function load(e) {
    alert("loading can take a bit of time if the taxonomy needs to be rebuilt")
    var file = e.target.files[0]
    loadFile(file)
}
function loadFile(file){
    if (!file) {
	return
    }
    var reader = new FileReader()
    reader.onload = function(e) {
	const contents = e.target.result
	const cdata = JSON.parse(contents)
	stage = cdata.stage
	formal_context.contents = []
	var concepts = {}
	for (var i in cdata.concepts){
	    var bv = new BinaryVector([])
	    bv._representation = cdata.concepts[i].intent._representation
	    bv.size = cdata.concepts[i].intent.size
	    var c = new Concept( bv , true)
	    formal_context.concepts.push(c)
	    concepts[bv._representation.join()] = c
	}	
	for (var i in cdata.concepts){
	    c1 = concepts[cdata.concepts[i].intent._representation.join()]
	    for (var j in cdata.concepts[i].subconcepts){
		c2 = concepts[cdata.concepts[i].subconcepts[j].intent._representation.join()]
		if (!c1.subconcepts) c1.subconcepts = []
		if (!c2.superconcepts) c2.superconcepts = []
		c1.subconcepts.push(c2)
		c2.superconcepts.push(c1)
	    }
	} 
	if (stage >= 1) document.getElementById("bc_message").innerHTML = "loaded"
	if (stage >= 1) document.getElementById("bt_message").innerHTML = "loaded"
	console.log(formal_context.root())
    }
    reader.readAsText(file);
}

function buildconcepts(){
    const starttime = new Date().getTime()
    console.log("started building concepts")
    formal_context.buildConcepts()
    document.getElementById("bc_message").innerHTML="completed in "+((new Date().getTime() - starttime)/1000)+"s"
    console.log(formal_context)
    stage = 1
}


function buildtaxonomy(){
    if (stage < 1){
	alert("you need to build concepts first")
	return
    }
    const starttime = new Date().getTime()
    console.log("started building taxonomy")
    formal_context.buildTaxonomy()
    document.getElementById("bt_message").innerHTML="completed in "+((new Date().getTime() - starttime)/1000)+"s"
    console.log(formal_context.root())
    stage = 2
}

function populate(){
   if (stage < 2){
	alert("you need to build taxonomy first")
	return
   }
    const starttime = new Date().getTime()
    console.log("started populating")
    formal_context.populate()
    formal_context.addLabels()    
    document.getElementById("p_message").innerHTML="completed in "+((new Date().getTime() - starttime)/1000)+"s"
    console.log(formal_context.root())
    document.getElementById('lattice').innerHTML = showConcept(formal_context.root(), 0)
    stage = 3    
}

function difference(a,b){
    var res = []
    for (var i in a)
	if (!b.includes(a[i])) res.push(a[i])
    return res
}


function rules(){
   if (stage < 3){
	alert("you need to populate first")
	return
   }
    const starttime = new Date().getTime()
    console.log("started rule extraction")
    var st = ""
    for (var i in formal_context.concepts){
	var c = formal_context.concepts[i]
	if (c.properAttributes.length > 0){
	    var rs = difference(c.attributes, c.properAttributes)
	    if (rs.length > 0) 
		st += c.properAttributes.join(",")+" -> "+rs.join(",")+'<br/>'
	}
    }
    document.getElementById("r_message").innerHTML="completed in "+((new Date().getTime() - starttime)/1000)+"s"
    document.getElementById('rules_ex').innerHTML = st
    stage = 3    
}

var concepts={}

function showConcept(c, indent){
    concepts[c.intent._representation.join("_")] = c
    var st = '<div style="margin-left: '+(indent*10)+'px">'
    st+='<a href="javascript:toogleExpand(\''+c.intent._representation.join("_")+'\')"><p style="margin-bottom: 0px;">['+c.attributes.join("|")+'] ('+c.subconcepts.length+')</p></a>'
    st+='<p style="margin-top: 0px;">{'+c.objects.join("|")+'}</p>'    
    st+='<div indent="'+(indent+1)+'" id="sc_'+c.intent._representation.join("_")+'" style="display: none">'
    // for (var i in c.subconcepts) st+=showConcept(c.subconcepts[i], indent+1)
    st += '</div></div>'
    return st
}

function toogleExpand(cc){
    if (document.getElementById("sc_"+cc).style.display == "none"){
	document.getElementById("sc_"+cc).style.display = "block"
	scs = concepts[cc].subconcepts
	const indent = parseInt(document.getElementById("sc_"+cc).getAttribute("indent"))
	var st = ""	
	for (var i in scs) st += showConcept(scs[i], indent)
	document.getElementById("sc_"+cc).innerHTML = st
    } else {
	document.getElementById("sc_"+cc).style.display = "none"
    }
}

    </script>    
  </body>
</html>


